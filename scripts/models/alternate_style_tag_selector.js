Readium.Models.AlternateStyleTagSelector=Backbone.Model.extend({initialize:function(){},activateAlternateStyleSet:function(b,a){var d,c=[];if(b.length===0)return a;d=$("link[rel*='stylesheet']",a);if(d.length===0)return a;d=this._storeOriginalAttributes(d);c=this._getStyleSetTitles(d);c=this._getStyleSetTitleToActivate(d,c,b);if(c===null)return a;this._activateStyleSet(d,c);return a},_activateStyleSet:function(b,a){b.each(function(){$styleSheet=$(this);$styleSheet.attr("rel","stylesheet");$styleSheet.attr("title")===
void 0?$styleSheet[0].disabled=!1:$.trim($styleSheet.attr("title"))===a?($styleSheet[0].disabled=!0,$styleSheet[0].disabled=!1):$styleSheet[0].disabled=!0});return b},_storeOriginalAttributes:function(b){var a;b.each(function(){a=$(this);a.data("orig-rel")===void 0&&a.attr("data-orig-rel",a.attr("rel"))});return b},_getStyleSetTitleToActivate:function(b,a,d){var c=[],g,e,h,f=[];for(g=0;g<a.length;g+=1)e=b.filter("link[title='"+a[g]+"']"),e=this._removeMutuallyExclusiveAltTags(e),c.push({numAltTagMatches:this._getNumAltStyleTagMatches(e,
d),styleSetTitle:a[g]});h=_.max(c,function(a){return a.numAltTagMatches}).numAltTagMatches;if(h===0)return null;_.each(c,function(a){a.numAltTagMatches===h&&f.push(a.styleSetTitle)});if(f!==1)for(a=0;a<f.length;a++)if(e=b.filter("link[title='"+f[a]+"']"),$.trim($(e[0]).attr("data-orig-rel"))==="stylesheet")return f[a];return f[0]},_getStyleSetTitles:function(b){var a=[];b.each(function(){var b=$(this).attr("title");_.include(a,b)||a.push(b)});return a},_getNumAltStyleTagMatches:function(b,a){var d=
0,c;for(c=0;c<a.length;c+=1)b.filter("link[class*='"+a[c]+"']").length>0&&d++;return d},_removeMutuallyExclusiveAltTags:function(b){var a;b.filter("link[class*='night']").length>0&&b.filter("link[class*='day']").length>0&&b.each(function(){a=$(this);a.filter(".night").length>0&&a.toggleClass("night");a.filter(".day").length>0&&a.toggleClass("day")});b.filter("link[class*='vertical']").length>0&&b.filter("link[class*='horizontal']").length>0&&b.each(function(){a=$(this);a.filter(".vertical").length>
0&&a.toggleClass("vertical");a.filter(".horizontal").length>0&&a.toggleClass("horizontal")});return b}});
